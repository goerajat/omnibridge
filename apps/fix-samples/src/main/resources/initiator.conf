# Sample Initiator Configuration
# This configuration simulates a trading client that initiates FIX connections

include "reference.conf"

# Component definitions - processed in dependency order
components {
    clock-provider {
        enabled = true
        factory = "com.omnibridge.config.factory.ClockProviderFactory"
        type = "com.omnibridge.config.ClockProvider"
    }

    network {
        enabled = true
        factory = "com.omnibridge.network.factory.NetworkEventLoopFactory"
        type = "com.omnibridge.network.NetworkEventLoop"
        dependencies = ["clock-provider"]
    }

    persistence {
        enabled = true
        factory = "com.omnibridge.persistence.factory.LogStoreFactory"
        type = "com.omnibridge.persistence.LogStore"
        dependencies = ["clock-provider"]
    }

    session-management {
        enabled = true
        factory = "com.omnibridge.config.factory.SessionManagementServiceFactory"
        type = "com.omnibridge.config.session.SessionManagementService"
    }

    fix-engine {
        enabled = true
        factory = "com.omnibridge.fix.engine.factory.FixEngineFactory"
        type = "com.omnibridge.fix.engine.FixEngine"
        dependencies = ["network", "clock-provider", "persistence", "session-management"]
    }

    admin-server {
        enabled = true
        factory = "com.omnibridge.admin.factory.AdminServerFactory"
        type = "com.omnibridge.admin.AdminServer"
        dependencies = ["session-management"]
    }
}

# Admin API configuration
admin {
  enabled = true
  host = "0.0.0.0"
  port = 8082
  context-path = "/api"
  cors {
    enabled = true
    allowed-origins = ["*"]
  }
  websocket {
    enabled = true
    path = "/ws"
  }
}

network {
  name = "initiator-event-loop"
  cpu-affinity = -1
  read-buffer-size = 65536
  write-buffer-size = 65536
  select-timeout-ms = 100
  busy-spin-mode = false
}

persistence {
  enabled = true
  store-type = "memory-mapped"
  base-path = "./fix-logs/initiator"
  max-file-size = 256MB
  sync-on-write = false
  max-streams = 100
}

fix-engine {

  sessions = [
    {
      session-name = "INITIATOR_SESSION"
      role = "initiator"
      sender-comp-id = "CLIENT"
      target-comp-id = "EXCHANGE"
      begin-string = "FIX.4.4"
      host = "localhost"
      port = 9876

      heartbeat-interval = 30
      reset-on-logon = true
      reset-on-logout = false
      reset-on-disconnect = false

      reconnect-interval = 5
      max-reconnect-attempts = 10
      time-zone = "UTC"

      log-messages = true
      max-message-length = 4096
      max-tag-number = 1000

      start-time = ""
      end-time = ""
      eod-time = ""
      reset-on-eod = false
    }
  ]
}
