# =============================================================================
# Exchange Simulator Configuration
# =============================================================================
# Multi-protocol exchange simulator supporting FIX, OUCH, iLink3, Optiq, and Pillar
# =============================================================================

include "simulator-components.conf"

# =============================================================================
# FIX Protocol Sessions
# =============================================================================
# Multi-session port sharing: All 5 sessions share port 9876.
# Clients are routed to the correct session based on their CompIDs in the Logon.
# =============================================================================
fix-engine {
    sessions = [
        {
            session-id = "FIX-SIM-1"
            port = 9876
            sender-comp-id = "EXCH1"
            target-comp-id = "CLIENT1"
            initiator = false
            begin-string = "FIX.4.4"
            heartbeat-interval = 30
        },
        {
            session-id = "FIX-SIM-2"
            port = 9876
            sender-comp-id = "EXCH2"
            target-comp-id = "CLIENT2"
            initiator = false
            begin-string = "FIX.4.4"
            heartbeat-interval = 30
        },
        {
            session-id = "FIX-SIM-3"
            port = 9876
            sender-comp-id = "EXCH3"
            target-comp-id = "CLIENT3"
            initiator = false
            begin-string = "FIX.4.4"
            heartbeat-interval = 30
        },
        {
            session-id = "FIX-SIM-4"
            port = 9876
            sender-comp-id = "EXCH4"
            target-comp-id = "CLIENT4"
            initiator = false
            begin-string = "FIX.4.4"
            heartbeat-interval = 30
        },
        {
            session-id = "FIX-SIM-5"
            port = 9876
            sender-comp-id = "EXCH5"
            target-comp-id = "CLIENT5"
            initiator = false
            begin-string = "FIX.4.4"
            heartbeat-interval = 30
        }
    ]
}

# =============================================================================
# OUCH Protocol Sessions
# =============================================================================
# Multi-session port sharing: Multiple sessions share port 9200.
# Clients are routed based on username in SoupBinTCP login.
# =============================================================================
ouch-engine {
    sessions = [
        {
            session-id = "OUCH-42-A"
            port = 9200
            username = "USER01"
            protocol-version = "4.2"
            initiator = false
        },
        {
            session-id = "OUCH-42-B"
            port = 9200
            username = "USER02"
            protocol-version = "4.2"
            initiator = false
        },
        {
            session-id = "OUCH-50"
            port = 9201
            username = "USER03"
            protocol-version = "5.0"
            initiator = false
        }
    ]
}

# =============================================================================
# iLink3 Protocol Sessions
# =============================================================================
ilink3-engine {
    sessions = [
        {
            session-id = "ILINK3-SIM"
            port = 9300
            initiator = false
            firm-id = "CME"
            session = "001"
            keep-alive-interval = 30000
        }
    ]
}

# =============================================================================
# Optiq Protocol Sessions
# =============================================================================
optiq-engine {
    sessions = [
        {
            session-id = "OPTIQ-SIM"
            port = 9400
            initiator = false
            logical-access-id = 100
            oeg-instance = 1
            firm-id = 1
            software-provider = "OmniBridge"
            heartbeat-interval = 30
        }
    ]
}

# =============================================================================
# Pillar Protocol Sessions
# =============================================================================
pillar-engine {
    sessions = [
        {
            session-id = "PILLAR-SIM"
            port = 9500
            initiator = false
            mpid = "TSIM"
            username = "PILLAR-SIM"
            password = "password"
            heartbeat-interval = 1
        }
    ]
}

# =============================================================================
# Fill Engine Rules
# =============================================================================
# Rules are evaluated in order (first match wins).
# Symbol patterns support wildcards: * (any chars), ? (single char)
# =============================================================================
fill-engine {
    rules = [
        # TEST symbols always fill immediately
        {
            symbol = "TEST*"
            fill-probability = 1.0
            partial-fill-probability = 0.0
        },
        # HALT symbols never fill
        {
            symbol = "HALT*"
            fill-probability = 0.0
        },
        # SLOW symbols have reduced fill rate
        {
            symbol = "SLOW*"
            fill-probability = 0.3
            partial-fill-probability = 0.5
        },
        # PARTIAL symbols always partially fill
        {
            symbol = "PARTIAL*"
            fill-probability = 1.0
            partial-fill-probability = 1.0
            min-partial-fill-ratio = 0.2
            max-partial-fill-ratio = 0.8
        },
        # Default rule - 80% fill rate with 20% partial fills
        {
            symbol = "*"
            fill-probability = 0.8
            partial-fill-probability = 0.2
        }
    ]
}

# =============================================================================
# Admin Server
# =============================================================================
admin {
    enabled = true
    host = "0.0.0.0"
    port = 8080
    context-path = "/api"
    cors {
        enabled = true
        allowed-origins = ["*"]
    }
    websocket {
        enabled = true
        path = "/ws"
    }
}

# =============================================================================
# Persistence
# =============================================================================
persistence {
    enabled = true
    store-type = "memory-mapped"
    base-path = "./data/simulator-logs"
    max-file-size = 256MB
    sync-on-write = false
}

# =============================================================================
# Network
# =============================================================================
network {
    name = "simulator-event-loop"
    cpu-affinity = -1
    read-buffer-size = 65536
    write-buffer-size = 65536
    select-timeout-ms = 100
    busy-spin-mode = false
}
