# =============================================================================
# Base Component Definitions
# =============================================================================
# This file defines all available components with their factories, types, and
# dependencies. Include this file in application configs and override the
# 'enabled' flag to enable/disable specific components.
#
# Usage in application config:
#   include "components.conf"
#
#   components {
#       persistence.enabled = false      # Disable persistence
#       admin-server.enabled = false     # Disable admin API
#   }
# =============================================================================

components {

    # =========================================================================
    # Core Infrastructure Components
    # =========================================================================

    # Clock provider - provides system time for all components
    # No dependencies - should be first in initialization order
    clock-provider {
        enabled = true
        factory = "com.omnibridge.config.factory.ClockProviderFactory"
        type = "com.omnibridge.config.ClockProvider"
    }

    # Network event loop - NIO-based async I/O
    # Depends on clock-provider for timing operations
    network {
        enabled = true
        factory = "com.omnibridge.network.factory.NetworkEventLoopFactory"
        type = "com.omnibridge.network.NetworkEventLoop"
        dependencies = ["clock-provider"]
    }

    # Persistence - Chronicle Queue based message logging
    # Depends on clock-provider for timestamps
    persistence {
        enabled = true
        factory = "com.omnibridge.persistence.factory.LogStoreFactory"
        type = "com.omnibridge.persistence.LogStore"
        dependencies = ["clock-provider"]
    }

    # Session scheduler - time-based session management (trading hours, EOD reset)
    # Depends on clock-provider for scheduling
    session-scheduler {
        enabled = true
        factory = "com.omnibridge.config.factory.SessionSchedulerFactory"
        type = "com.omnibridge.config.schedule.SessionScheduler"
        dependencies = ["clock-provider"]
    }

    # Session management service - unified session tracking across protocols
    # No dependencies - provides cross-protocol session registry
    session-management {
        enabled = true
        factory = "com.omnibridge.config.factory.SessionManagementServiceFactory"
        type = "com.omnibridge.config.session.SessionManagementService"
    }

    # =========================================================================
    # Protocol Engines
    # =========================================================================

    # FIX protocol engine
    # Depends on network, clock, and optionally persistence and session-management
    fix-engine {
        enabled = true
        factory = "com.omnibridge.fix.engine.factory.FixEngineFactory"
        type = "com.omnibridge.fix.engine.FixEngine"
        dependencies = ["network", "clock-provider", "persistence", "session-management"]
    }

    # OUCH protocol engine
    # Depends on network, clock, and session-management
    ouch-engine {
        enabled = true
        factory = "com.omnibridge.ouch.engine.factory.OuchEngineFactory"
        type = "com.omnibridge.ouch.engine.OuchEngine"
        dependencies = ["network", "clock-provider", "session-management"]
    }

    # =========================================================================
    # Admin & Monitoring
    # =========================================================================

    # Admin server - REST API and WebSocket for session monitoring
    # Depends on session-management for session data
    admin-server {
        enabled = true
        factory = "com.omnibridge.admin.factory.AdminServerFactory"
        type = "com.omnibridge.admin.AdminServer"
        dependencies = ["session-management"]
    }

    # Metrics - Micrometer + Prometheus metrics collection
    # Depends on admin-server to register /api/metrics endpoint
    metrics {
        enabled = true
        factory = "com.omnibridge.metrics.factory.MetricsFactory"
        type = "com.omnibridge.metrics.MetricsComponent"
        dependencies = ["admin-server"]
    }
}

# =============================================================================
# Default Configuration for Components
# =============================================================================
# These provide sensible defaults that can be overridden in application configs

# Network defaults
network {
    name = "default-event-loop"
    cpu-affinity = -1
    read-buffer-size = 65536
    write-buffer-size = 65536
    select-timeout-ms = 100
    busy-spin-mode = false
}

# Admin server defaults
admin {
    host = "0.0.0.0"
    port = 8080
    context-path = "/api"
    cors {
        enabled = true
        allowed-origins = ["*"]
    }
    websocket {
        enabled = true
        path = "/ws"
    }
}

# Metrics defaults
metrics {
    enabled = true
    include-jvm = true
    histogram-percentiles = [0.5, 0.9, 0.95, 0.99, 0.999]
}

# Persistence defaults
persistence {
    enabled = true
    store-type = "chronicle"
    base-path = "./data/logs"
    max-file-size = 256MB
    sync-on-write = false
    max-streams = 100
}
