global:
  resolve_timeout: 5m
  slack_api_url: "${SLACK_WEBHOOK_URL}"

route:
  group_by:
    - alertname
    - app
    - session
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 4h
  receiver: slack-default
  routes:
    - match:
        severity: critical
      receiver: pagerduty-critical
      group_wait: 10s
      repeat_interval: 1h
    - match:
        severity: warning
      receiver: slack-warning
      repeat_interval: 4h

receivers:
  - name: slack-default
    slack_configs:
      - channel: "#omnibridge-alerts"
        send_resolved: true
        title: '{{ template "slack.title" . }}'
        text: '{{ template "slack.text" . }}'
        actions:
          - type: button
            text: "View in Prometheus"
            url: "http://localhost:9090/alerts"
          - type: button
            text: "View in Grafana"
            url: "http://localhost:3001"

  - name: slack-warning
    slack_configs:
      - channel: "#omnibridge-alerts"
        send_resolved: true
        title: '{{ template "slack.title" . }}'
        text: '{{ template "slack.text" . }}'

  - name: pagerduty-critical
    pagerduty_configs:
      - service_key: "${PAGERDUTY_SERVICE_KEY}"
        severity: critical
        description: '{{ template "pagerduty.description" . }}'
    slack_configs:
      - channel: "#omnibridge-critical"
        send_resolved: true
        title: '{{ template "slack.title" . }}'
        text: '{{ template "slack.text" . }}'

inhibit_rules:
  - source_match:
      severity: critical
    target_match:
      severity: warning
    equal:
      - alertname
      - instance

templates:
  - /etc/alertmanager/templates/*.tmpl
